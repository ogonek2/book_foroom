# Руководство по работе с Excel в админ панели

## Возможности Excel интеграции

### Экспорт книг

#### 1. Экспорт всех книг
- **Расположение:** В разделе "Книги" нажмите кнопку "Экспорт в Excel"
- **Формат файла:** .xlsx
- **Содержимое:** Все книги из базы данных с полной информацией
- **Имя файла:** `books-YYYY-MM-DD-HH-mm-ss.xlsx`

#### 2. Экспорт выбранных книг
- **Расположение:** Выберите нужные книги чекбоксами, затем нажмите "Экспорт выбранных"
- **Формат файла:** .xlsx
- **Содержимое:** Только выбранные книги
- **Имя файла:** `selected-books-YYYY-MM-DD-HH-mm-ss.xlsx`

### Импорт книг

#### 1. Скачивание шаблона
- **Расположение:** В разделе "Книги" нажмите кнопку "Скачать шаблон"
- **Файл:** `books-template.xlsx`
- **Содержимое:** Пустой файл с заголовками колонок

#### 2. Импорт из Excel
- **Расположение:** В разделе "Книги" нажмите кнопку "Импорт из Excel"
- **Поддерживаемые форматы:** .xlsx, .xls
- **Процесс:** Загрузите файл и нажмите "Импорт"

## Структура Excel файла

### Заголовки колонок (для импорта)

| Колонка | Описание | Обязательное | Тип данных | Примечание |
|---------|----------|--------------|------------|------------|
| `nazvanie` | Название книги | **Да** | Строка (макс. 255 символов) | Единственное обязательное поле |
| `slag` | URL-слаг | Нет | Строка (макс. 255 символов) | Автогенерируется из названия |
| `opisanie` | Описание книги | Нет | Текст | По умолчанию: "-" |
| `avtor_staryy` | Автор (старое поле) | Нет | Строка | По умолчанию: "-" |
| `isbn` | ISBN | Нет | Строка | По умолчанию: "-" |
| `god_izdaniya` | Год издания | Нет | Число (1000-текущий год+1) | По умолчанию: null |
| `izdatelstvo` | Издательство | Нет | Строка | По умолчанию: "-" |
| `oblozhka` | Путь к обложке | Нет | Строка | По умолчанию: "-" |
| `yazyk` | Язык | Нет | Строка (макс. 5 символов) | По умолчанию: "ru" |
| `stranitsy` | Количество страниц | Нет | Число (больше 0) | По умолчанию: null |
| `reiting` | Рейтинг | Нет | Число (0-5) | По умолчанию: 0.0 |
| `kolichestvo_recenziy` | Количество рецензий | Нет | Число (больше или равно 0) | По умолчанию: 0 |
| `kategoriya` | Название категории | Нет | Строка | **Создается автоматически** |
| `avtor` | Имя автора | Нет | Строка (формат: "Имя Фамилия") | **Создается автоматически** |
| `rekomenduemaya` | Рекомендуемая | Нет | "Да" или "Нет" | По умолчанию: "Нет" |

### Пример данных для импорта

```
nazvanie,slag,opisanie,avtor_staryy,isbn,god_izdaniya,izdatelstvo,oblozhka,yazyk,stranitsy,reiting,kolichestvo_recenziy,kategoriya,avtor,rekomenduemaya
"Война и мир","","Роман Льва Толстого","","978-5-17-123456-7",1869,"АСТ","","ru",1274,4.8,156,"Классическая литература","Лев Толстой","Да"
"1984","","Антиутопический роман","","978-5-17-123457-4",1949,"АСТ","","ru",328,4.5,89,"Научная фантастика","Джордж Оруэлл","Нет"
"Простая книга","","","","","","","","","","","","","",""
```

### Минимальный пример (только обязательные поля)

```
nazvanie
"Название книги"
"Другая книга"
"Третья книга"
```

## Правила валидации

### Обязательные поля
- `nazvanie` - название книги (единственное обязательное поле)

### Автоматические значения
- **Пустые поля:** автоматически заполняются символом "-"
- **Слаг:** генерируется автоматически из названия книги
- **Категории:** создаются автоматически при первом упоминании
- **Авторы:** создаются автоматически при первом упоминании

### Ограничения
- **Год издания:** от 1000 до текущего года + 1
- **Страницы:** больше 0 (если указано)
- **Рейтинг:** от 0 до 5 (если указано)
- **Количество рецензий:** больше или равно 0 (если указано)
- **Название:** максимум 255 символов
- **Язык:** максимум 5 символов
- **Рекомендуемая:** только "Да" или "Нет" (в любом регистре)

### Связи с другими таблицами
- **Категория:** создается автоматически, если не существует
- **Автор:** создается автоматически, если не существует (формат: "Имя Фамилия")

## Обработка ошибок

### При импорте
- Ошибки валидации отображаются в уведомлениях
- Некорректные строки пропускаются
- Успешно импортированные записи сохраняются

### Типичные ошибки
1. **Несуществующая категория** - создайте категорию в админ панели
2. **Несуществующий автор** - создайте автора в админ панели
3. **Некорректный формат даты** - используйте только числа для года
4. **Некорректный рейтинг** - используйте числа от 0 до 5

## Рекомендации

### Для экспорта
- Регулярно экспортируйте данные для резервного копирования
- Используйте экспорт выбранных книг для работы с конкретными записями

### Для импорта
1. Всегда скачивайте и используйте актуальный шаблон
2. Проверьте существование категорий и авторов перед импортом
3. Начните с небольшого количества записей для тестирования
4. Сохраните резервную копию перед массовым импортом

### Форматирование Excel файла
- Используйте заголовки точно как в шаблоне
- Не изменяйте порядок колонок
- Используйте корректные типы данных
- Для булевых значений используйте "Да"/"Нет"

## Техническая информация

### Используемые пакеты
- `maatwebsite/excel` - для работы с Excel файлами
- `phpoffice/phpspreadsheet` - для обработки данных

### Поддерживаемые форматы
- **Экспорт:** .xlsx
- **Импорт:** .xlsx, .xls

### Ограничения
- Максимальный размер файла: определяется настройками PHP
- Количество записей: ограничено памятью сервера
- Время выполнения: зависит от количества записей
